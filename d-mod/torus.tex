\chapter{Torus quotients}
\label{ch:d-mod:torus}

The goal of this section is to prove the following theorem.

\begin{Thm}
    \label{thm:d-mod:torus:is-good}%
    Let $G$ be a torus acting locally linearly on a (?) scheme $X$.
    Then the stack $\stack X = X/G$ is good.
\end{Thm}

By Lemma~\ref{lem:d-mod:strategy:cover}, it suffices to prove the theorem for affine schemes $X$.
Set $G = \Gm^n$.
We will compactify $G$ to $(\ps1)^n$.
We note that the variety $(\ps1)^n$ can be covered by $G$-equivariant open subvarieties of the form $\as n$.
Thus by Lemma~\ref{lem:d-mod:strategy:cover-by-relative-compactifications}, it suffices to check \goodness\ for the relative compactification $\Gm^n \subseteq \as n$.
To simplify notation, we set $\bar{\stack X} = \bar{\stack X}_{\as n}$.

In the following we fix a quotient stack $\stack Y = Y/G$ and a morphism $h\colon \stack Y → \stack X$.
We will be concerned with the diagrams
\[
    \begin{tikzcd}
        \cls_{\stack Y} \stack X \arrow[r, "\bar q"] \arrow[d] & \bar{\stack X} \arrow[d, "\bar Δ"] \\
        \stack Y \arrow[r, "h∘Δ"] & \stack X × \stack X
    \end{tikzcd}
    \text{ and }
    \begin{tikzcd}
        \lsc_{\stack Y} \stack X \arrow[r, hook, "i"] \arrow[d] & \cls_{\stack Y} \stack X \arrow[d, "\bar q"] \\
        \bar{\stack X}^c \arrow[r, hook] & \bar{\stack X}
    \end{tikzcd}
\]
Rather than working with stack directly, we will base change to schemes.
For this consider the notation introduced in the following diagram with Cartesian squares.
\[
    \begin{tikzcd}
        \schemelsc_{\stack Y} \stack X \arrow[r, hook, "\schemei"] \arrow[d] & \schemecls_{\stack Y} \stack X \arrow[r, "\bar\schemeq"] \arrow[d] & \bar Γ \arrow[d] & G × X \arrow[l, hook', "\schemej"'] \arrow[d] \\
        \lsc_{\stack Y} \stack X \arrow[r, hook, "i"] & \cls_{\stack Y} \stack X \arrow[r, "\bar q"] & \bar{\stack X} & \stack X \arrow[l, hook', "j"']
    \end{tikzcd}
\]
Since pullback along the smooth vertical morphisms is conservative, it suffices to show that $\schemei^* \bar\schemeq^!\schemej_! \sheaf F = 0$ for all $G$-monodromic [ToDo: define] $\sheaf F ∈ \catDModC{G × X}$.
Further let $\schemeh\colon X → Y$ be the $G$-equivariant morphism of schemes inducing $h$ on quotient stacks.
Then the scheme $\schemecls_{\stack Y} \stack X$ is given by
\[
    \schemecls_{\stack Y} \stack X =
    \biggl\{
        \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ
    \biggr\}.
\]
We will cut this space into pieces according to the subgroups of $G$ that stabilize them.
Thus let $\Stab\stack X$ be the set of all closed subgroups of $G$ that are stabilizers of points of $X$, i.e.
\[
    \Stab\stack X = \{ G_x : x ∈ X \}.
\]

\begin{Lem}
    The set $\Stab\stack X$ is finite.
\end{Lem}

\begin{proof}
    Since $X$ is affine, it can be embedded $G$-equivariantly into some $\as m$ with a linear $T$-action.
    For $\as m/T$ the statement is easy to see.
\end{proof}

Let $S$ be closed subgroup of $G$ and let $X^S$ be the $S$-fixed points of $X$.
Since $G$ is Abelian (and hence $S$ a normal subgroup), $X^S$ is a $G$-stable closed subscheme of $X$.
Hence $X^S/G$ is a closed substack of $\stack X$.
Let $\bar S$ be the closure of $S$ in $\bar G = \as n$ and consider the space
\[
    \schemecls[S]_{\stack Y} \stack X =
    \biggl\{
        \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \schemeh(y) ∈ X^S,\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ \text{ and } g₂ ∈ g₁\bar S
    \biggr\}
    ⊆ 
    \schemecls_{\stack Y} \stack X.
\]

\begin{Lem}
    The subspaces $\schemecls[S]_{\stack Y} \stack X$ for $S ∈ \Stab\stack X$ cover $\schemecls_{\stack Y}\stack X$.
\end{Lem}

\begin{proof}
    Let $\schemelsY Y \stack X$ be the smooth cover of $\ls_{\stack Y}\stack X$.
    Consider the spaces
    \[
        \schemelsY[S] \stack X = 
        \biggl\{
            \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × G : \schemeh(y) ∈ X^S,\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ Γ \text{ and } g₂ ∈ g₁S
        \biggr\}
        \subseteq \schemelsY \stack X.
    \]
    The closure of $\schemelsY[S] \stack X$ in $\schemeclsY \stack X$ is exactly $\schemeclsY[S] \stack X$.
    It is easy to see that the subspaces $\schemelsY[S] \stack X$ for $S ∈ \Stab \stack X$ cover $\schemelsY[S] \stack X$.
    Now the statement follows from the fact that the closure of a finite union is the union of the individual closures.
\end{proof}

We have a Cartesian square of closed embeddings
\[
    \begin{tikzcd}
        \schemelscY[S] \stack X \arrow[r, hook, "i_S^c"] \arrow[d, hook, "\schemei^S"] & \schemelscY\stack X \arrow[d, hook, "\schemei"] 
        \\
        \schemeclsY[S] \stack X \arrow[r, hook, "i_S"]   & \schemeclsY\stack X 
    \end{tikzcd}
\]

\begin{Lem}\label{lem:d-mod:key_for_stablizier}%
    For any $S ∈ \Stab\stack X$ and any $\sheaf F ∈ \catDMod{Γ}^{G×G\text{-mon}}$ we have
    \[
        \schemei^{S,*} i_S^! \bar\schemeq^! \schemej_! \sheaf F = 0.
    \]
\end{Lem}


\begin{proof}
    The scheme $\schemelsc[S] \stack X$ is of the form
    \[
        \schemelscY[S] \stack X  = 
        \biggl\{
            \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \schemeh(y) ∈ X^S,\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ \text{ and } g₂ ∈ g₁(\bar S \setminus S)
        \biggr\}.
    \]
    If $S = \bar S$ the statement is trivially true.
    Otherwise the scheme $\bar S \setminus S$ is the union of hyperplanes $H_i$ of $\bar S$.
    It suffices to prove the statement when further restricting to 
    \[
        \biggl\{
            \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \schemeh(y) ∈ X^S,\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ \text{ and } g₂ ∈ g₁H_i
        \biggr\}.
    \]
    for all $i$. 
    Let $H$ be one such hyperplane.
    We will assume that $H$ is contained in the closure of the connected component of $1 ∈ S$. 
    The proof for $H$ is a different component is the same, up to a shift by an element of $G$.
    Let $\schemei_H$ be the inclusion of
    \[
        Z = 
        \biggl\{
            \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \schemeh(y) ∈ X^S,\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ \text{ and } g₂ ∈ g₁H
        \biggr\}.
    \]
    into $\schemeclsY[S] \stack X$.
    We want to compute
    \[
        \schemei_H^{*} i_S^! \bar\schemeq^! \schemej_! \sheaf F.
    \]

    \iffalse
    Consider the Cartesian square
    \[
        \begin{tikzcd}
            Γ \arrow[r, hook, "\schemej"] \arrow[d, "\tilde q"] & \bar Γ \arrow[d, "q"] \\
            T \arrow[r, hook, "\schemej_T"] & \bar T
        \end{tikzcd}
    \]
    By Theorem~\ref{thm:d-mod:smoothness_of_compactification}, the vertical arrows are smooth.
    Thus,
    \[
        \schemej_! k_Γ = 
        \schemej_! \tilde q^* k_T = 
        q^* \schemej_{T,!} k_T = 
        q^! \schemej_{T,!} k_T.
    \]
    Let $f = q ∘ \schemep₂ ∘ i_S$, so that
    \[
        \schemei_H^{*} i_S^! \schemep₂^! \schemej_! k_Γ = 
        \schemei_H^{*} i_S^! \schemep₂^! q^! \schemej_{T,!} k_T = 
        \schemei_H^{*} f^! \schemej_{T,!} k_T.
    \]
    \fi

    Write $G \cong G₁ × S$ for some subgroup $G₁$ of $G$.
    Then $\bar G = \bar G₁ \bar S$.
    Let $H' = \bar G₁ H$.
    We note that $G ∩ H' = \emptyset$.
    
    We chose an action $μ$ of $\Gm$ on $\bar S$ that contracts $\bar S$ onto $H$.
    This induces an action of $\Gm$ on $\bar T = \bar T₁ \bar S$ by $u \cdot ts = tμ(u,s)$, contracting $\bar T$ onto $H'$.
    Further we obtain an action of $\Gm$ on $\bar Γ$ that keeps the first $X$ coordinate fixed.
    By construction this action contracts $\bar Γ$ onto a closed subvariety of $\bar Γ \setminus Γ$.
    We will denote this subvariety by $Z₁$ and the contraction morphism $π\colon \bar Γ → Z₁$ by $π₁$.
    We can also lift this action to $\schemeclsY\stack X$ where it contracts onto $Z$.
    We will denote the corresponding contraction morphism by $π\colon \schemeclsY[S]\stack X → Z$.

    We note that the D-modules $\schemej_!\sheaf F$ and $i_S^!\bar\schemeq^!\schemej_! \sheaf F$ are monodromic with respect to these $\Gm$-actions.
    The contraction principle \cite[Theorem~C.5.3]{DrinfeldGaitsgory:arXiv:CompactGenerationOfDModOnBunG} thus implies that
    % Note: Do not need renormalized pushforward, since π is evidently schematic.
    \[
        \schemei_H^* i_S^!\bar\schemeq^!\schemej_! \sheaf F = π_* i_S^!\bar\schemeq^!\schemej_! \sheaf F.
    \]
    The square
    \[
        \begin{tikzcd}
            \schemecls[S] \arrow[r, "π"] \arrow[d, "\schemeq ∘ i_S"] & Z \arrow[d] \\
            \bar Γ \arrow[r, "π₁"] & Z₁
        \end{tikzcd}
    \]
    is Cartesian. 
    Let us call the right vertical map $f$.
    Base change yields
    \[
        π_* i_S^!\bar\schemeq^!\schemej_! \sheaf F = 
        f^!π_{1,*} \schemej_! \sheaf F.
    \]
    Finally, let $i_{Z₁}\colon Z₁ \hookrightarrow \bar Γ$ be the inclusion.
    Applying the contraction principle again we obtain
    \[
        f^!π_{1,*} \schemej_! \sheaf F =
        f^!i_{Z₁}^* \schemej_! \sheaf F =
        0.
        \qedhere
    \]
\end{proof}

\begin{proof}[Outline of proof of Theorem~\ref{thm:d-mod:torus:is-good}]
    Iterated Mayer-Vietoris argument using Lemma~\ref{lem:d-mod:key_for_stablizier}.
    Note that if $S₁,\, S₂ ∈ \Stab\stack X$, then
    \[
        \schemeclsY[S₁]\stack X ∩ \schemeclsY[S₂]\stack X =
        \biggl\{
            \bigl(g₁,\, y,\, g₂\bigr) ∈ G × Y × \bar G : \schemeh(y) ∈ X^{S₁S₂},\, \bigl(\schemeh(y),\, g₂,\, g₁\schemeh(y)\bigr) ∈ \bar Γ \text{ and } g₂ ∈ g₁(\bar S₁ ∩ \bar S₂)
        \biggr\},
    \]
    to which we can apply the arguments of Lemma~\ref{lem:d-mod:key_for_stablizier}.
    [ToDo: Change Lemma~\ref{lem:d-mod:key_for_stablizier} to make this explicit.]
    [ToDo: Write up this proof.]
\end{proof}
